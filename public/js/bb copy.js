const bbHelper={pagination:{pageSize:10,pageNum:1},leancloudRequestData:{},api:{login:"https://ssapi.esmyy.com/1.1/login",post:"https://ssapi.esmyy.com/1.1/classes/moments"},storage:{info:"MOMENTS_PUBLISHER_INFO"},selector:{bbWrapper:".bbWrapper",loginWrapper:".loginWrapper",loginBtn:".loginBtn",username:".bbUsername",password:".bbPassword",postBtn:".postBtn",content:".content"},init(){const{appId:e,appKey:t,serverUrls:s}=window.hexoHelper.get_leancloud();new Artitalk({appId:e,appKey:t,serverUrls:s}),this.listen(),this.checkStatus()},listen(){window.leancloudRequestData?this.onReadyToLoad(leancloudRequestData):window.onLeancloudReady=this.onReadyToLoad.bind(this)},onReadyToLoad(e){this.headers=e},getElement:e=>document.querySelector(e),login(e){fetch(this.api.login,{method:"POST",headers:this.headers,body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.error?toastr.error(e.error):(toastr.success("登录成功"),localStorage.setItem(this.storage.info,JSON.stringify(e)),this.checkStatus())}))},post(e){fetch(this.api.post,{method:"POST",headers:{...this.headers},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.error?toastr.error(e.error):toastr.success("发布成功")}))},getElement:e=>document.querySelector(e),checkStorage:e=>!!localStorage.getItem(e),checkStatus(){const e=document.querySelector(this.selector.bbWrapper);this.checkStorage(this.storage.info)?(e.classList.add("ready"),this.registerPostHandler(e)):(e.classList.remove("ready"),this.registerLoginHandler(e))},registerPostHandler(e){const t=e.querySelector(this.selector.content),s=e.querySelector(this.selector.postBtn),o=this;s.addEventListener("click",(function(){const e=t.value;e&&o.post({atContentHtml:`<p>${e}</p>`,atContentMd:e,avatar:"https://avatars.githubusercontent.com/u/20430185?v=4"})}))},registerLoginHandler(e){const t=e.querySelector(this.selector.loginBtn),s=e.querySelector(this.selector.username),o=e.querySelector(this.selector.password),r=this;t.addEventListener("click",(function(){s.value&&o.value&&r.login({username:s.value,password:o.value})}))}};bbHelper.init();