const artitalkHelper={pagination:{pageSize:10,pageNum:1},leancloudRequestData:{},api:{shuoshuo:"https://ssapi.esmyy.com/1.1/classes/shuoshuo"},selector:{loadmore:"#shoushuoLoadMore",more:".more",nomore:".nomore",loading:".loading",list:"#shuoshuoList"},loadmore:null,list:null,createShuoshuoNode(e){const t=this.getTime(e.createdAt),s=e.atContentMd.replace(/(#[^\s]*)/g,(function(e){return`<span class="tag">${e.replace("#","")}</span>`})),o=document.createElement("div");return o.classList.add("shuoshuoItem"),o.innerHTML=`\n      <p class="time">${t}</p>\n      <p class="content">${s}</p>\n    `,o},getTime(e){const t=new Date(e);return`${t.getFullYear()}-${["0",t.getMonth()+1].join("").slice(-2)}-${["0",t.getDay()+1].join("").slice(-2)} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`},init(){const{appId:e,appKey:t,serverUrls:s}=window.hexoHelper.get_leancloud();new Artitalk({appId:e,appKey:t,serverUrls:s}),this.listen(),this.addLoadmoreListener()},listen(){window.leancloudRequestData?this.onReadyToLoad(leancloudRequestData):window.onLeancloudReady=this.onReadyToLoad.bind(this)},onReadyToLoad(e){this.headers=e,this.fetchShuoshuo()},getElement:e=>document.querySelector(e),addLoadmoreListener(){const e=this.loadmore||this.getElement(this.selector.loadmore),t=e.querySelector(this.selector.more),s=this;t&&t.addEventListener("click",(()=>{s.fetchShuoshuo()})),this.loadmore||(this.loadmore=e)},pureSelector:e=>e.replace(/[\.#]/g,""),fetchShuoshuo(){const e=this.pagination.pageSize,t=(this.pagination.pageNum-1)*this.pagination.pageSize,s=`${this.api.shuoshuo}?where=%7B%7D&limit=${e}&skip=${t}&order=-createdAt`;return fetch(s,{headers:this.headers}).then((e=>e.json())).then((e=>{this.pagination.pageNum++;const t=e.results||[];t.length?this.renderList(t):toastr.info("没有更多数据了...")}))},renderList(e){const t=this.loadmore||this.getElement(this.selector.loadmore);e.length>=this.pagination.pageSize?(t.classList.remove(this.pureSelector(this.selector.nomore),this.pureSelector(this.selector.loading)),t.classList.add(this.pureSelector(this.selector.more))):(t.classList.remove(this.pureSelector(this.selector.more),this.pureSelector(this.selector.loading)),t.classList.add(this.pureSelector(this.selector.nomore)));const s=this.list||document.querySelector(this.selector.list),o=new DocumentFragment;e.filter((e=>!!e.atContentMd)).forEach((e=>{o.appendChild(this.createShuoshuoNode(e))})),s.appendChild(o),this.list||(this.list=s)}};artitalkHelper.init();